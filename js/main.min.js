function spawn(){(new Date).getTime()>lastTime+minSpawnTime&&(lastTime=(new Date).getTime(),parts.push(new smoke(emitterX,emitterY)))}function render(){var e=parts.length;for(ctx.clearRect(0,0,canvas.width,canvas.height);e--;)if(parts[e].y<0||parts[e].lifeTime>maxLifeTime)parts.splice(e,1);else{parts[e].update(),ctx.save();var t=-parts[e].size/2,a=-parts[e].size/2;ctx.translate(parts[e].x-t,parts[e].y-a),ctx.rotate(parts[e].angle/180*Math.PI),ctx.globalAlpha=parts[e].alpha,ctx.drawImage(smokeImage,t,a,parts[e].size,parts[e].size),ctx.restore()}spawn(),requestAnimationFrame(render)}function smoke(e,t){this.x=e,this.y=t,this.size=1,this.startSize=32,this.endSize=40,this.angle=359*Math.random(),this.startLife=(new Date).getTime(),this.lifeTime=0,this.velY=-1-.5*Math.random(),this.velX=Math.floor(-6*Math.random()+3)/10}function resizeMe(){canvas.height=document.body.offsetHeight}$(function(){var e=Snap("#globie"),t=e.select("#leftEye"),a=e.ellipse(220,150,27,40).attr({}),i=e.select("#rightEye"),n=e.ellipse(280,150,27,40).attr({}),s=e.select("#globieBody"),o=document.querySelector("#globie"),m=(document.querySelector("#legs"),Snap.path.getTotalLength(t)),r=Snap.path.getTotalLength(t),l=Snap.path.getBBox(t),h=Snap.path.getBBox(i),p={x:l.x+l.width/2,y:l.y+l.height/2},c={x:h.x+h.width/2,y:h.y+h.height/2},g=Snap.path.getPointAtLength(t),f=Snap.path.getPointAtLength(i);$(document).mousemove(function(e){mX=e.pageX-$("#globie").offset().left,mY=e.pageY-$("#globie").offset().top,tl=Snap.angle(p.x,p.y,mX,mY)/360,tr=Snap.angle(c.x,c.y,mX,mY)/360,g=t.getPointAtLength(tl*m%m),lpalx=g.x,lpaly=g.y,f=i.getPointAtLength(tr*r%r),rpalx=f.x,rpaly=f.y,a.attr(Snap.path.isPointInside(t,mX,mY)?{cx:mX,cy:mY}:{cx:lpalx,cy:lpaly}),n.attr(Snap.path.isPointInside(i,mX,mY)?{cx:mX,cy:mY}:{cx:rpalx,cy:rpaly})}),$(document).on("mousedown",".globieParts",function(t){mX=t.pageX-$("#globie").offset().left,mY=t.pageY-$("#globie").offset().top,zit=Math.floor(20*Math.random())+10,e.ellipse(mX,mY,zit,zit).attr({fill:"url(#acne)","class":"globieParts hole"}).insertAfter(s)}),$(document).on("dblclick",function(){$("#globieBody").remove(o)}),$("#envelope").hover(function(){$("svg").find("#skin").css("fill","#FAAFBE")},function(){$("svg").find("#skin").css("fill","#FFFFFF")})}),function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e}();var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");canvas.height=document.body.offsetHeight,canvas.width=300;var parts=[],minSpawnTime=40,lastTime=(new Date).getTime(),maxLifeTime=Math.min(5e3,canvas.height/90*1e3),emitterX=canvas.width/2,emitterY=canvas.height-10,smokeImage=new Image;smoke.prototype.update=function(){this.lifeTime=(new Date).getTime()-this.startLife,this.angle+=.2;var e=this.lifeTime/maxLifeTime*100;this.size=this.startSize+(this.endSize-this.startSize)*e*.1,this.alpha=1-.01*e,this.alpha=Math.max(this.alpha,0),this.x+=this.velX,this.y+=this.velY},smokeImage.src="img/smoke.png",smokeImage.onload=function(){render()},window.onresize=resizeMe,window.onload=resizeMe;